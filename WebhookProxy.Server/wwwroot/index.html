<html>

<head>

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    
    <script src="lib/vue/vue.js"></script>
    <script src="lib/signalr/signalr.js"></script>
    <script src="lib/signalr/proxyClient.js"></script>
    <script src="lib/moment/moment-with-locales.js"></script>
    <script src="lib/misc/syntax_highlight.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Oswald|Abel|Inconsolata" rel="stylesheet">
    <link href="style.css" rel="stylesheet">

    <title>Webhook Proxy</title>
</head>
<body style="background-color: #62d2d6;">

    <div id="app">

        <h1>
        </h1>

        <!-- CHANGE DESTINATION URL -->
        <div v-if="askingForDestination" style="position:fixed;top:0px;left:0px; float:left;width:100%;height:100%;background-color: #62d2d6;">
            <div style="background-color:red;width:70%;margin-left:auto;margin-right:auto;margin-top:20%;">
                <input type="text" class="destinationEndpointInput" v-model="destinationEndpointUrl" v-on:keyup.13="askingForDestination = false" placeholder="ENTER DESTINATION ENDPOINT (i.e. http://localhost:8080)" />
            </div>
        </div>


        <!-- CLEAN TRANSACTION LOG -->
        <div style="float:right;font-family: Inconsolata;font-size: 13px;">
            <img v-if="transactionLog.length > 0 && !askingForDestination" v-on:click="transactionLog = [];" src="img/duster.svg" style="cursor:pointer;width:48px;margin-right:30px;margin-top:30px;transform: rotate(180deg);" alt="CLEAN UP" title="CLEAN UP" />
        </div>


        <!-- LOGO -->
        <table>
            <tr>
                <td>
                    <img src="img/logo.svg" style="width:34px;margin-right:7px;margin-top:3px;float:left;" />
                </td>
                <td style="vertical-align: top;">
                    <span class="h1" style="font-family:Oswald;font-size:36px;margin:0px;padding:0px;color:white;">WEBHOOK-PROXY</span>
                </td>
            </tr>
        </table>


        <!-- CONNECTION STATE -->
        <div style="margin:20px;">
            <h3 v-if="serverConnectionState == 'disconnected'">NO CONNECTION</h3>
            <h3 v-if="serverConnectionState == 'connecting'">CONNECTING..</h3>
        </div>


        <!-- ENDPOINTS -->
        <div style="margin:20px;">

            <table v-if="serverConnectionState == 'connected'">
                <tr>
                    <td>
                        <h3 style="color:#f0f0f0;font-family: 'Abel', sans-serif;font-weight: bold;font-size:16px;margin-bottom:5px;">WEBHOOK URL</h3>
                    </td>
                    <td>
                        <h3 id="webhookUrl" v-on:click="" style="color:#f0f0f0;font-family: 'Abel', sans-serif;font-weight: bold;font-size:16px;margin-bottom:5px;">{{domainName}}/{{ serverConnectionId }}</h3>
                    </td>
                </tr>
                <tr>
                    <td style="padding-right:20px;">
                        <h3 style="color:#f0f0f0;font-family: 'Abel', sans-serif;font-weight: bold;font-size:16px;cursor: pointer;" v-on:click="askingForDestination = true">FORWARD URL</h3>
                    </td>
                    <td>
                        <h3 style="color:#f0f0f0;font-family: 'Abel', sans-serif;font-weight: bold;font-size:16px;cursor: pointer;" v-on:click="askingForDestination = true">{{ destinationEndpointUrl }}</h3>
                    </td>
                </tr>
            </table>


        </div>


        <!-- CURRENT TRANSACTION -->
        <div v-if="serverConnectionState == 'connected'">
            <h1 style="font-size:28px;color:white;margin-left:20px;">CURRENT TRANSACTION</h1>
            <hr style="margin:20px;margin-top:10px;border:1px solid white;" />
        </div>

        <div v-if="serverConnectionState == 'connected' && !currentTransaction" style="font-family:Inconsolata;font-size:14px;margin:20px;margin-top:20px;margin-bottom:30px;padding:15px;background-color:#ffffff;">
            Waiting for incoming webhook..
        </div>

        <div v-if="currentTransaction">

            <div style="margin:20px;margin-top:0px;margin-bottom:30px;padding:15px;background-color:#ffffff;">

                <div v-if="currentTransaction.response.headers || currentTransaction.response.body" style="margin-bottom:15px;">
                    <div>
                        <span v-if="hideTransactionHeaders" style="font-size:14px;font-family:'Oswald','Inconsolata',sans-serif;color:lightgray;cursor: pointer;margin-right:5px;" v-on:click="hideTransactionHeaders=false;">HEADERS</span>
                        <span v-if="!hideTransactionHeaders" style="font-size:14px;font-family:'Oswald','Inconsolata',sans-serif;color:black;cursor: default;margin-right:5px;">HEADERS</span>

                        <span v-if="hideTransactionHeaders" style="font-size:14px;font-family:'Oswald','Inconsolata',sans-serif;color:black;cursor: default;">BODY</span>
                        <span v-if="!hideTransactionHeaders" style="font-size:14px;font-family:'Oswald','Inconsolata',sans-serif;color:lightgray;cursor: pointer;" v-on:click="hideTransactionHeaders=true;">BODY</span>

                    </div>
                </div>

                <hr>

                <div style="margin-top:15px;">
                    <div style="float:right;font-family: Inconsolata;font-size: 13px;">
                        {{ currentTransaction.created }}
                    </div>
                    <h3 style="margin:0px;">{{ currentTransaction.proxyRequest.method }} REQUEST FROM PROXY</h3>
                </div>

                <div style="margin-top:20px;margin-bottom:30px;">
                    <div v-if="!hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="currentTransaction.proxyRequest.headers"></div>
                    <div v-if="hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="currentTransaction.proxyRequest.body"></div>
                </div>

                <hr>

                <div style="margin-top:15px;">
                    <div style="float:right;font-family: Inconsolata;font-size: 13px;">
                        {{ currentTransaction.response.created }}
                    </div>
                    <h3 v-if="currentTransaction.response.status != 'sending'" style="margin:0px;">HTTP {{ currentTransaction.response.statusCode }} RESPONSE FROM DESTINATION</h3>
                    <h3 v-if="currentTransaction.response.status == 'sending'" style="margin:0px;">Waiting for response from destination..</h3>

                </div>

                <br>
                <div v-if="!hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="currentTransaction.response.headers"></div>
                <div v-if="hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="currentTransaction.response.body"></div>

            </div>

        </div>


        <!-- TRANSACTION LOG -->
        <h1 v-if="serverConnectionState == 'connected'" style="font-size:28px;color:white;margin:0px;margin-left:20px;">TRANSACTION LOG</h1>
        <hr v-if="serverConnectionState == 'connected'" style="margin:20px;margin-top:10px;border:1px solid white;" />
        
        <div v-if="serverConnectionState == 'connected' && transactionLog.length == 0" style="font-family:Inconsolata;font-size:14px;margin:20px;margin-top:20px;margin-bottom:30px;padding:15px;background-color:#ffffff;">
            No transactions yet :(
        </div>

        <div v-if="transactionLog.length > 0" style="margin-bottom:15px;margin-left:20px;font-size:14px;font-family:'Oswald','Inconsolata',sans-serif;">
            <div>
                <span v-if="hideTransactionHeaders" style="color:white;cursor: pointer;margin-right:5px;" v-on:click="hideTransactionHeaders=false;">HEADERS</span>
                <span v-if="!hideTransactionHeaders" style="color:#f0f0f0;cursor: default;margin-right:5px;">HEADERS</span>

                <span v-if="hideTransactionHeaders" style="color:#f0f0f0;cursor: default;">BODY</span>
                <span v-if="!hideTransactionHeaders" style="color:white;cursor: pointer;" v-on:click="hideTransactionHeaders=true;">BODY</span>

            </div>
        </div>

        <div v-for="(transaction, index) in transactionLog.slice().reverse()" style="margin:20px;margin-top:0px;margin-bottom:20px;padding:15px;background-color:#ffffff;">

            <div v-if="transaction.expandedView == false" v-on:click="transaction.expandedView = true">
                <h3 style="margin:0px;float:right;">{{ moment(transaction.created).format("hh:mm:ss") }}</h3>
                <h3 style="margin:0px;">HTTP {{ transaction.request.method }} - HTTP {{ transaction.response.statusCode }}</h3>
            </div>

            <div v-if="transaction.expandedView == true" v-on:click="transaction.expandedView = false">

                <div style="font-family: Inconsolata, Arial, Helvetica, sans-serif;font-size:16px;">
                    <div style="float:right;">
                        {{ moment(transaction.created).format("hh:mm:ss") }}
                    </div>
                    <h3 style="margin:0px;">HTTP {{ transaction.proxyRequest.method }} - REQUEST FROM PROXY</h3>
                </div>

                <div style="margin-top:20px;margin-bottom:20px;">
                    <div v-if="!hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="transaction.proxyRequest.headers"></div>
                    <div v-if="hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;" v-html="transaction.proxyRequest.body"></div>
                </div>

                <hr style="border:1px solid lightgray;">

                <div style="margin-top:20px;">
                    <div style="float:right;font-family: Inconsolata;font-size: 16px;">
                        {{ moment(transaction.response.created).format("hh:mm:ss") }}
                    </div>
                    <h3 v-if="transaction.response.status" style="margin:0px;">HTTP {{ transaction.response.statusCode }} - RESPONSE FROM DESTINATION</h3>

                </div>

                <br>
                <div v-if="!hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;margin-bottom:10px;" v-html="transaction.response.headers"></div>
                <div v-if="hideTransactionHeaders" style="font-family:Inconsolata;font-size:14px;margin-bottom:10px;" v-html="transaction.response.body"></div>

            </div>

        </div>            

    </div>

    <script src="lib/vue/app.js"></script>
    
</body>

</html>